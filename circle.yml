machine:
  php:
    version: 7.0.4

dependencies:
  pre:
    - export PATH="$HOME/.yarn/bin:$PATH"
    - curl -o- -s -L https://yarnpkg.com/install.sh | bash
  override:
    - mkdir -p build/logs
    - composer install --dev --no-interaction
    # - sed -i 's/^;//' ~/.phpenv/versions/$(phpenv global)/etc/conf.d/xdebug.ini
  cache_directories:
    - "~/.yarn-cache"
    - "~/.composer/cache"

test:
  override:
    - php vendor/bin/phpunit
    - php vendor/bin/coveralls -v

general:
  artifacts:
    - "build"

deployment:
  publish:
    branch: master
    commands:
      - composer require sereno/installer
      - yarn --no-progress
      - sereno deploy
